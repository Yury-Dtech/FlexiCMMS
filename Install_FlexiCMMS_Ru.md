### Инструкция по развертыванию FlexiCMMS на сервере Linux

Эта инструкция описывает развертывание приложения FlexiCMMS на сервере Linux. Вы можете выбрать развертывание с Nginx в качестве обратного прокси или напрямую с Kestrel. Процесс развертывания автоматизирован с помощью специализированных скриптов.

**Предварительные требования:**

*   Сервер Linux (например, Ubuntu 20.04+ или Debian 10+).
*   Доступ к серверу по SSH.
*   Опубликованный ZIP-архив вашего приложения (`flexicmms.zip`).
*   При развертывании *без Nginx* требуется файл сертификата `.pfx` (`blazortool.pfx`) для HTTPS.

---

**Шаг 0: Подготовка к развертыванию**

1.  **Передайте необходимые файлы на сервер:**
    Скопируйте следующие файлы в домашнюю директорию пользователя на вашем сервере (например, `/home/youruser/`):
    *   ZIP-архив приложения: `flexicmms.zip`
    *   **Выберите один скрипт развертывания:**
        *   Для развертывания *с Nginx*: `deploy_flexicmms_nginx.sh`
        *   Для развертывания *без Nginx*: `deploy_flexicmms_NoNginx.sh`
    *   При развертывании *без Nginx* также скопируйте файл сертификата PFX: `blazortool.pfx` (убедитесь, что он имеет имя `blazortool.pfx` и пароль `dtech`, как указано в скрипте и конфигурации Kestrel).

    Пример использования `scp` (скорректируйте в зависимости от выбранного метода развертывания):
    ```bash
    # Для развертывания с Nginx
    scp /path/to/local/deploy_flexicmms_nginx.sh user@your_server_ip:/home/user/
    scp /path/to/local/FlexiCMMS.zip user@your_server_ip:/home/user/

    # Для развертывания без Nginx
    scp /path/to/local/deploy_flexicmms_NoNginx.sh user@your_server_ip:/home/user/
    scp /path/to/local/FlexiCMMS.zip user@your_server_ip:/home/user/
    scp /path/to/local/blazortool.pfx user@your_server_ip:/home/user/
    ```

2.  **Подключитесь к серверу по SSH:**
    ```bash
    ssh user@your_server_ip
    ```

3.  **Сделайте выбранный скрипт исполняемым:**
    ```bash
    # Для развертывания с Nginx
    chmod +x deploy_flexicmms_nginx.sh

    # Для развертывания без Nginx
    chmod +x deploy_flexicmms_NoNginx.sh
    ```

---

**Шаг 1: Запуск скрипта развертывания**

Запустите выбранный скрипт с правами суперпользователя. Скрипт запросит у вас адрес API сервера и другую необходимую информацию, а затем выполнит все необходимые шаги по установке зависимостей, распаковке приложения, настройке `appsettings.json` и настройке Systemd-сервиса.

*   **Для развертывания с Nginx:**
    ```bash
    sudo ./deploy_flexicmms_nginx.sh
    ```
    Во время выполнения скрипт попросит вас ввести:
    *   Актуальный адрес API сервера (например, `http://10.1.41.122:1122/api/v1/`). Скрипт автоматически добавит завершающий слеш, если он отсутствует.
    *   Доменное имя или IP-адрес для Nginx (например, `example.com` или `192.168.1.100`).

*   **Для развертывания без Nginx:**
    ```bash
    sudo ./deploy_flexicmms_NoNginx.sh
    ```
    Во время выполнения скрипт попросит вас ввести актуальный адрес API сервера. Убедитесь, что вы вводите его в правильном формате (например, `http://10.1.41.122:1122/api/v1/`). Скрипт автоматически добавит завершающий слеш, если он отсутствует.

---

**Шаг 2: Проверка статуса и доступности приложения**

После завершения работы скрипта:

1.  **Проверьте статус сервиса FlexiCMMS:**
    ```bash
    sudo systemctl status flexicmms
    ```
    Вы должны увидеть, что сервис активен (`active (running)`).

2.  **Настройте фаервол и получите доступ к приложению:**

    *   **При развертывании с Nginx:**
        Убедитесь, что порт 80 (HTTP) открыт в фаерволе вашего сервера. Если вы используете `ufw`, вы можете открыть его так:
        ```bash
        sudo ufw allow 80/tcp
        sudo ufw enable # Если фаервол не активен
        ```
        Теперь ваше FlexiCMMS-приложение должно быть доступно по доменному имени или IP-адресу вашего сервера через Nginx.
        **Важное примечание:** Если вы планируете использовать HTTPS, вам необходимо вручную настроить SSL-сертификат в Nginx (например, с помощью Certbot) после выполнения этого скрипта и открыть порт 443 в фаерволе.

    *   **При развертывании без Nginx:**
        Убедитесь, что порты 80 (HTTP) и 443 (HTTPS) открыты в фаерволе вашего сервера. Если вы используете `ufw`, вы можете открыть их так:
        ```bash
        sudo ufw allow 80/tcp
        sudo ufw allow 443/tcp
        sudo ufw enable # Если фаервол не активен
        ```
        Теперь ваше FlexiCMMS-приложение должно быть доступно по IP-адресу или доменному имени вашего сервера через HTTP (порт 80) и HTTPS (порт 443).
        **Важное примечание:** Если вы используете самоподписанный сертификат (`blazortool.pfx`), браузеры будут выдавать предупреждения о безопасности. Для продакшен-среды рекомендуется использовать сертификат, выданный доверенным центром сертификации (например, Let's Encrypt).